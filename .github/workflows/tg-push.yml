name: Push Alert

on: [push]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: "!contains(github.event.head_commit.message, 'Merge pull request')"
    steps:
      - run: |
          COMMIT_MSG=$(echo '${{ github.event.head_commit.message }}' | head -n1)
          TIMESTAMP=$(TZ='Asia/Phnom_Penh' date +"%b %d at %I:%M %p")
          COMMIT_HASH=$(echo '${{ github.sha }}' | cut -c1-7)
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendMessage" \
          -d chat_id=${{ secrets.TG_CHAT_ID }} \
          -d message_thread_id=$TG_TOPIC_ID \
          -d parse_mode=Markdown \
          -d text=$'ğŸš€ *Code just dropped*\n\nğŸ‘¤ @${{ github.actor }}\nğŸŒ¿ `${{ github.ref_name }}`\nâ±ï¸ '"$TIMESTAMP"$' ICT\n\nğŸ’¬ _'"$COMMIT_MSG"$'_\nğŸ”– `'"$COMMIT_HASH"$'`\n\n[View diff](${{ github.event.head_commit.url }})\n\nâœ¨ ship it, no cap'


env:
  TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
  TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
  TG_TOPIC_ID: ${{ secrets.TG_TOPIC_ID }}
