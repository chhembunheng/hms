name: Push Alert

on: [push]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - run: |
          COMMIT_MSG=$(echo '${{ github.event.head_commit.message }}' | head -n1)
          TIMESTAMP=$(TZ='Asia/Phnom_Penh' date +"%b %d, %Y at %I:%M %p ICT")
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendMessage" \
          -d chat_id=${{ secrets.TG_CHAT_ID }} \
          -d message_thread_id=$TG_TOPIC_ID \
          -d parse_mode=Markdown \
          -d text=$'ðŸš€ *Code Push*\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n*Branch:* `${{ github.ref_name }}`\n*Author:* ${{ github.actor }}\n*Time:* '"$TIMESTAMP"$'\n\n*Commit Message:*\n_'"$COMMIT_MSG"$'_\n\n*Hash:* `${{ github.sha }}`\n\n[View Commit](${{ github.event.head_commit.url }})'


env:
  TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
  TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
  TG_TOPIC_ID: ${{ secrets.TG_TOPIC_ID }}
