name: Push Alert

on: [push]

jobs:
  notify:
    runs-on: ubuntu-latest
    if: "!contains(github.event.head_commit.message, 'Merge pull request')"
    steps:
      - name: Send Telegram Notification
        run: |
          COMMIT_MSG=$(echo "${{ github.event.head_commit.message }}" | head -n1)
          TIMESTAMP=$(TZ='Asia/Phnom_Penh' date +"%b %d at %I:%M %p")
          COMMIT_HASH=$(echo "${{ github.sha }}" | cut -c1-7)

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendMessage" \
            -d chat_id="${{ secrets.TG_CHAT_ID }}" \
            -d message_thread_id="${{ secrets.TG_TOPIC_ID }}" \
            -d parse_mode="Markdown" \
            -d text=$'ğŸš€ *Code á…áŸá‰á–á¸áŠáŸƒ Dev á€á˜áŸ’ášá·áá‘áŸáœáá¶* \n\n\ ğŸ‘¤ @${{ github.actor }} (áŸášáŸáŸášáŠáŸ„á™á”áŸ’ášá¾á‡áŸ†á“á¿ 10%)\n\ ğŸŒ¿ `${{ github.ref_name }}` branch á€áŸ†á–á»á„áŸá“áŸ’á›á”áŸ‹\n\ â±ï¸ '"$TIMESTAMP"$' ICT\n\n\ ğŸ’¬ _'"$COMMIT_MSG"$'_\n\ ğŸ”– `'"$COMMIT_HASH"$'`\n\n\ ğŸ‘€ [á…á»á…á˜á¾á›á—á¶á–á˜á á“áŸ’áášá¶á™](${{ github.event.head_commit.url }})\n\n\ ğŸ˜ á˜áŸ‰á¶áŸáŸŠá¸á“ááŸ’á‰á»áŸ†áŠá¾áš á˜áŸ‰á¶áŸáŸŠá¸á“á‚áŸá˜á·á“áŠá¹á„\n\'
        env:
          TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
          TG_TOPIC_ID: ${{ secrets.TG_TOPIC_ID }}
