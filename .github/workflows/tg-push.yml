name: Push Alert

on: [push]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - run: |
          COMMIT_MSG=$(echo '${{ github.event.head_commit.message }}' | head -n1)
          TIMESTAMP=$(TZ='Asia/Phnom_Penh' date +"%b %d at %I:%M %p")
          COMMIT_HASH=$(echo '${{ github.sha }}' | cut -c1-7)
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TG_BOT_TOKEN }}/sendMessage" \
          -d chat_id=${{ secrets.TG_CHAT_ID }} \
          -d message_thread_id=$TG_TOPIC_ID \
          -d parse_mode=Markdown \
          -d text=$'ğŸš€ *Code just dropped* ğŸ”¥\nâ•™â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•œ\n\nğŸ‘¤ *Dev:* @${{ github.actor }}\nğŸŒ¿ *Branch:* `${{ github.ref_name }}`\nâ±ï¸ *Pushed:* '"$TIMESTAMP"$' ICT\n\nğŸ’¬ *What changed:*\n_'"$COMMIT_MSG"$'_\n\nğŸ”– *Commit:* `'"$COMMIT_HASH"$'`\n\nğŸ‘‰ [View the diff](${{ github.event.head_commit.url }})\nâ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâœ¨ Ship it, test it, no cap âœ…'


env:
  TG_BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
  TG_CHAT_ID: ${{ secrets.TG_CHAT_ID }}
  TG_TOPIC_ID: ${{ secrets.TG_TOPIC_ID }}
